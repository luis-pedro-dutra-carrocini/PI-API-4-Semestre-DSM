<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API - Medi√ß√µes & Relat√≥rios</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1,
        h2,
        h3 {
            color: #222;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        pre {
            background: #eee;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }

        a {
            color: #0056b3;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-block;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .auth-info {
            background-color: #e6f7ff;
            border-left: 4px solid #3399ff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .auth-info h4 {
            margin-top: 0;
            margin-bottom: 5px;
        }

        .auth-info code {
            background-color: #d6eaf8;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .status-code {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }

        .note {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .warning {
            background-color: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>üìä API - Medi√ß√µes & Relat√≥rios</h1>
    <p>Esta √© a documenta√ß√£o da API para o registro de medi√ß√µes e a obten√ß√£o de relat√≥rios de uso das mochilas. As
        rotas de relat√≥rios exigem autentica√ß√£o de usu√°rio via token JWT.</p>

    <div class="section" id="endpoints">
        <h2>üîó Endpoints</h2>
        <ul>
            <li><a href="index.html">Voltar ao Menu</a></li>
        </ul>
        <ul>
            <li><a href="#post-criar-medicao">POST - /medicoes/</a> - Criar medi√ß√£o (requer token IoT)</li>
            <li><a href="#get-atual-medicao">GET - /medicoes/atual/:mochila</a> - √öltima medi√ß√£o por local</li>
            <li><a href="#get-relatorio-semanal">GET - /medicoes/semanal/:mochila</a> - Relat√≥rio semanal</li>
            <li><a href="#get-previsao-dia">GET - /medicoes/previsao/:mochila/:data</a> - Previs√£o para dia espec√≠fico</li>
            <li><a href="#get-relatorio-geral">GET - /medicoes/geral/:mochila</a> - Relat√≥rio geral com estat√≠sticas</li>
            <li><a href="#get-relatorio-mensal">GET - /medicoes/mensal/:ano/:mes/:mochila</a> - Relat√≥rio mensal</li>
            <li><a href="#get-relatorio-anual">GET - /medicoes/anual/:ano/:mochila</a> - Relat√≥rio anual</li>
            <li><a href="#get-relatorio-dia">GET - /medicoes/dia/:data/:mochila</a> - Relat√≥rio di√°rio</li>
            <li><a href="#get-relatorio-peso">GET - /medicoes/diaMaisMenosPeso/:mochila</a> - Dia com mais e menos peso</li>
            <li><a href="#get-relatorio-periodo">GET - /medicoes/periodo/:inicio/:fim/:mochila</a> - Relat√≥rio por per√≠odo</li>
        </ul>
    </div>

    <div class="section" id="autenticacao">
        <h2>üîí Autentica√ß√£o</h2>
        <p>A maioria dos endpoints desta API requer autentica√ß√£o de sess√£o via <strong>JSON Web Token (JWT)</strong>. O
            token deve ser enviado no cabe√ßalho (header) da requisi√ß√£o, utilizando o esquema <code>Bearer</code>.</p>
        <h3>Exemplo de Header de Requisi√ß√£o:</h3>
        <pre>Authorization: Bearer &lt;seu_token_aqui&gt;</pre>
        
        <div class="auth-info">
            <h4>‚ö†Ô∏è Nota Importante:</h4>
            <p>A rota <strong>POST /medicoes/</strong> requer autentica√ß√£o IoT (<code>tipo === 'iot'</code>), enquanto todas as outras rotas requerem autentica√ß√£o de usu√°rio (<code>tipo === 'usuario'</code>).</p>
        </div>
    </div>

    <div class="section" id="post-criar-medicao">
        <h2>üìù POST - /medicoes/</h2>
        <p>Registra uma nova medi√ß√£o de peso para uma mochila espec√≠fica, enviada por um dispositivo IoT. A valida√ß√£o inclui o status de uso da mochila e o limite de peso do usu√°rio. Requer <strong>autentica√ß√£o IoT</strong>.</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Autentica√ß√£o Espec√≠fica:</strong> Esta rota requer token JWT do tipo <code>iot</code>, n√£o de usu√°rio.
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MedicaoPeso": 12.5,
    "MedicaoLocal": "esquerda" // Valores v√°lidos: "esquerda", "direita", "centro", "ambos"
}</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">201 Created:</span> <code>{ "ok": true, "message": "Medi√ß√£o registrada com sucesso" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "Peso √© obrigat√≥rio" }</code>, <code>{ "error": "Local √© obrigat√≥rio" }</code>, <code>{ "error": "Peso da medi√ß√£o deve ser maior ou igual a zero" }</code>, <code>{ "error": "Local deve ser 'esquerda', 'direita', 'centro' ou 'ambos'" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Mochila n√£o autenticada" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para mochila" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code>, <code>{ "error": "Nenhum usu√°rio ativo para esta mochila" }</code>, <code>{ "error": "Usu√°rio n√£o encontrado na tabela" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao registrar medi√ß√£o" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-atual-medicao">
        <h2>üïê GET - /medicoes/atual/:mochila</h2>
        <p>Retorna a √∫ltima medi√ß√£o registrada para cada local (esquerda, direita, ambos, centro) de uma mochila espec√≠fica. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/atual/mochila_codigo_exemplo</pre>
        <h3>Resposta de Sucesso (200 OK):</h3>
        <pre>{
    "ok": true,
    "esquerda": {
        "MedicaoPeso": 5.2,
        "MedicaoData": "2025-09-06T15:30:00.000Z",
        "MedicaoStatus": "Dentro do limite",
        "MedicaoLocal": "esquerda",
        "MedicaoPesoMaximoPorcentagem": 85.2,
        "MedicaoPesoMais": 1.5
    },
    "direita": { ... },
    "ambos": { ... },
    "centro": { ... }
}</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna objeto com √∫ltimas medi√ß√µes por local</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "ID do usu√°rio inv√°lido" }</code> ou <code>{ "error": "Informe o c√≥digo da mochila" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Usu√°rio n√£o encontrado" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao buscar medi√ß√µes" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-relatorio-semanal">
        <h2>üóìÔ∏è GET - /medicoes/semanal/:mochila</h2>
        <p>Retorna todas as medi√ß√µes registradas para uma mochila espec√≠fica nos √∫ltimos 7 dias. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/semanal/mochila_codigo_exemplo</pre>
        <h3>Resposta de Sucesso (200 OK):</h3>
        <pre>[
    {
        "MedicaoPeso": 10.5,
        "MedicaoData": "2025-09-06T15:30:00.000Z",
        "MedicaoStatus": "Dentro do limite",
        "MedicaoLocal": "ambos",
        "MedicaoPesoMaximoPorcentagem": 85.2,
        "MedicaoPesoMais": 1.5
    },
    ...
]</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna array de objetos de medi√ß√£o dos √∫ltimos 7 dias</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "ID do usu√°rio inv√°lido" }</code> ou <code>{ "error": "Informe o c√≥digo da mochila" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code>, <code>{ "error": "Nenhuma medi√ß√£o encontrada nos √∫ltimos 7 dias" }</code> ou <code>{ "error": "Usu√°rio n√£o est√° vinculado a esta mochila" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao buscar relat√≥rio semanal" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-previsao-dia">
        <h2>üîÆ GET - /medicoes/previsao/:mochila/:data</h2>
        <p>Calcula previs√£o de peso para um dia espec√≠fico da semana baseado em dados hist√≥ricos do mesmo dia da semana. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/previsao/mochila_codigo_exemplo/2025-09-10</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna objeto com previs√£o e estat√≠sticas</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "ID do usu√°rio inv√°lido" }</code>, <code>{ "error": "Informe o c√≥digo da mochila" }</code> ou <code>{ "error": "Data inv√°lida" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Usu√°rio n√£o est√° vinculado a esta mochila" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao calcular previs√£o" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-relatorio-geral">
        <h2>üìà GET - /medicoes/geral/:mochila</h2>
        <p>Retorna relat√≥rio geral completo com todas as medi√ß√µes do usu√°rio para uma mochila, incluindo estat√≠sticas detalhadas e agrupamento por dia da semana. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/geral/mochila_codigo_exemplo</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna objeto com estat√≠sticas e dados agrupados</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "ID do usu√°rio inv√°lido" }</code> ou <code>{ "error": "Informe o c√≥digo da mochila" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Nenhuma medi√ß√£o encontrada" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao buscar relat√≥rio geral" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-relatorio-mensal">
        <h2>üìÖ GET - /medicoes/mensal/:ano/:mes/:mochila</h2>
        <p>Retorna todas as medi√ß√µes registradas para uma mochila em um m√™s e ano espec√≠ficos. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/mensal/2025/08/mochila_codigo_exemplo</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna array de medi√ß√µes do m√™s processadas</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "Informe m√™s e ano" }</code> ou <code>{ "error": "ID do usu√°rio inv√°lido" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Usu√°rio n√£o encontrado" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao buscar e processar relat√≥rio mensal" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-relatorio-anual">
        <h2>üìä GET - /medicoes/anual/:ano/:mochila</h2>
        <p>Retorna relat√≥rio anual com m√©dias mensais e estat√≠sticas para uma mochila em um ano espec√≠fico. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/anual/2025/mochila_codigo_exemplo</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna objeto com m√©dias mensais e estat√≠sticas</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "Ano inv√°lido" }</code> ou <code>{ "error": "Informe o c√≥digo da mochila" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Usu√°rio n√£o encontrado" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao buscar relat√≥rio anual" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-relatorio-dia">
        <h2>‚òÄÔ∏è GET - /medicoes/dia/:data/:mochila</h2>
        <p>Retorna todas as medi√ß√µes registradas para uma mochila em um dia espec√≠fico. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/dia/2025-08-10/mochila_codigo_exemplo</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna array de medi√ß√µes do dia</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "Informe a data" }</code> ou <code>{ "error": "Data inv√°lida" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Nenhuma medi√ß√£o encontrada no dia informado" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao buscar relat√≥rio di√°rio" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-relatorio-peso">
        <h2>‚öñÔ∏è GET - /medicoes/diaMaisMenosPeso/:mochila</h2>
        <p>Encontra as medi√ß√µes com o maior e o menor peso registrado para uma mochila. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/diaMaisMenosPeso/mochila_codigo_exemplo</pre>
        <h3>Resposta de Sucesso (200 OK):</h3>
        <pre>{
    "ok": true,
    "maisPeso": {
        "MedicaoPeso": 15.2,
        "MedicaoData": "2025-09-06T15:30:00.000Z",
        "MedicaoStatus": "Acima do limite",
        "MedicaoLocal": "ambos",
        "MedicaoPesoMaximoPorcentagem": 120.5,
        "MedicaoPesoMais": 3.2
    },
    "menosPeso": {
        "MedicaoPeso": 2.1,
        "MedicaoData": "2025-09-05T10:15:00.000Z",
        "MedicaoStatus": "Dentro do limite",
        "MedicaoLocal": "esquerda",
        "MedicaoPesoMaximoPorcentagem": 25.3,
        "MedicaoPesoMais": 8.9
    }
}</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna objeto com medi√ß√µes de maior e menor peso</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "ID do usu√°rio inv√°lido" }</code> ou <code>{ "error": "Informe o c√≥digo da mochila" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Nenhuma medi√ß√£o encontrada" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao buscar dia mais/menos peso" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-relatorio-periodo">
        <h2>üï∞Ô∏è GET - /medicoes/periodo/:inicio/:fim/:mochila</h2>
        <p>Retorna todas as medi√ß√µes para uma mochila dentro de um intervalo de datas informado. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        <h3>Par√¢metros de URL:</h3>
        <pre>/medicoes/periodo/2025-08-01/2025-08-15/mochila_codigo_exemplo</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna array de medi√ß√µes do per√≠odo</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "Datas de in√≠cio e fim s√£o obrigat√≥rias (formato: YYYY-MM-DD)" }</code> ou <code>{ "error": "Datas inv√°lidas" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Nenhuma medi√ß√£o encontrada nesse per√≠odo" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao buscar medi√ß√µes por per√≠odo" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>
</body>

</html>