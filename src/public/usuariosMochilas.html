<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API - Mochilas Usu√°rio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1,
        h2,
        h3 {
            color: #222;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        pre {
            background: #eee;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }

        a {
            color: #0056b3;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-block;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .status-code {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }

        .note {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .warning {
            background-color: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .auth-info {
            background-color: #e6f7ff;
            border-left: 4px solid #3399ff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>üéí API - Mochilas Usu√°rio</h1>
    <p>Esta √© a documenta√ß√£o da API para a intera√ß√£o do usu√°rio com as mochilas. A maioria dos endpoints exige autentica√ß√£o de sess√£o do usu√°rio.</p>

    <div class="section" id="endpoints">
        <h2>üîó Endpoints</h2>
        <ul>
            <li><a href="index.html">Voltar ao Menu</a></li>
        </ul>
        <ul>
            <li><a href="#get-usuario">GET - /usuarios-mochilas/usuario</a> - Obter mochilas do usu√°rio</li>
            <li><a href="#get-uso">GET - /usuarios-mochilas/mochilaUso</a> - Obter mochila em uso pelo usu√°rio</li>
            <li><a href="#post-vincular">POST - /usuarios-mochilas/vincular</a> - Vincular mochila a usu√°rio</li>
            <li><a href="#delete-desvincular">DELETE - /usuarios-mochilas/desvincular</a> - Desvincular mochila do usu√°rio</li>
            <li><a href="#put-editar-nome">PUT - /usuarios-mochilas/editarNome</a> - Editar nome/apelido da mochila</li>
            <li><a href="#post-assumir-uso">POST - /usuarios-mochilas/assumir</a> - Assumir uso de mochila</li>
            <li><a href="#post-encerrar-app">POST - /usuarios-mochilas/encerrarUsoApp</a> - Encerrar uso via app</li>
            <li><a href="#post-encerrar-iot">POST - /usuarios-mochilas/encerrarUsoIOT</a> - Encerrar uso via IOT</li>
        </ul>
    </div>

    <div class="section" id="autenticacao">
        <h2>üîí Autentica√ß√£o</h2>
        <p>A maioria dos endpoints desta API requer autentica√ß√£o de sess√£o via <strong>JSON Web Token (JWT)</strong>. O token deve ser enviado no cabe√ßalho (header) da requisi√ß√£o, utilizando o esquema <code>Bearer</code>.</p>
        <h3>Exemplo de Header de Requisi√ß√£o:</h3>
        <pre>Authorization: Bearer &lt;seu_token_aqui&gt;</pre>
        
        <div class="auth-info">
            <h4>‚ö†Ô∏è Nota Importante:</h4>
            <p>A rota <strong>POST /usuarios-mochilas/encerrarUsoIOT</strong> requer autentica√ß√£o IoT (<code>tipo === 'iot'</code>), enquanto todas as outras rotas requerem autentica√ß√£o de usu√°rio (<code>tipo === 'usuario'</code>).</p>
        </div>
    </div>

    <div class="section" id="get-usuario">
        <h2>üì• GET - /usuarios-mochilas/usuario</h2>
        <p>Obt√©m todas as mochilas vinculadas ao usu√°rio logado, com informa√ß√µes sobre o status de uso e per√≠odo. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        
        <div class="note">
            <strong>‚ö†Ô∏è Filtro:</strong> Apenas retorna mochilas com status "Ativo" no sistema.
        </div>
        
        <h3>Cabe√ßalho da requisi√ß√£o:</h3>
        <pre>Authorization: Bearer &lt;access_token&gt;</pre>
        
        <h3>Resposta de Sucesso (200 OK):</h3>
        <pre>{
    "mochilas": [
        {
            "MochilaCodigo": "ABC123XYZ",
            "MochilaDescricao": "Mochila de teste",
            "MochilaPesoMax": 10.5,
            "MochilaNome": "Mochila de Viagem",
            "UsoStatus": "N√£o Usando",
            "DataFimUso": null,
            "DataInicioUso": null
        },
        ...
    ],
    "ok": true
}</pre>
        
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna array de objetos com as mochilas do usu√°rio</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "ID do usu√°rio inv√°lido" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao obter mochilas" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-uso">
        <h2>üì• GET - /usuarios-mochilas/mochilaUso</h2>
        <p>Obt√©m a mochila que o usu√°rio logado est√° usando atualmente (status "Usando" ou "√öltimo a Usar"). Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        
        <h3>Cabe√ßalho da requisi√ß√£o:</h3>
        <pre>Authorization: Bearer &lt;access_token&gt;</pre>
        
        <h3>Resposta de Sucesso (200 OK):</h3>
        <pre>{
    "mochila": {
        "MochilaCodigo": "ABC123XYZ",
        "MochilaDescricao": "Mochila de teste",
        "MochilaPesoMax": 10.5,
        "MochilaNome": "Mochila de Viagem",
        "UsoStatus": "Usando",
        "DataFimUso": null,
        "DataInicioUso": "2025-09-15T10:30:00.000Z"
    },
    "ok": true
}</pre>
        
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna objeto com a mochila em uso</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "ID do usu√°rio inv√°lido" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Nenhuma mochila encontrada para o usu√°rio", "mochila": "Nenhuma" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao obter mochilas" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="post-vincular">
        <h2>üîó POST - /usuarios-mochilas/vincular</h2>
        <p>Vincula uma mochila existente ao usu√°rio logado, usando o c√≥digo da mochila e um apelido para identifica√ß√£o. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        
        <div class="note">
            <strong>‚ö†Ô∏è Restri√ß√£o:</strong> Apenas mochilas com status "Ativo" no sistema podem ser vinculadas.
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ",
    "MochilaNome": "Mochila do Trabalho"
}</pre>
        
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "Mochila vinculada com sucesso" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila √© obrigat√≥rio" }</code> ou <code>{ "error": "ID do usu√°rio inv√°lido" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Usu√°rio n√£o encontrado" }</code></li>
            <li><span class="status-code">409 Conflict:</span> <code>{ "error": "Usu√°rio j√° est√° vinculado a esta mochila" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao vincular mochila" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="delete-desvincular">
        <h2>üîì DELETE - /usuarios-mochilas/desvincular</h2>
        <p>Remove o v√≠nculo entre o usu√°rio logado e uma mochila espec√≠fica. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Importante:</strong> Esta opera√ß√£o remove permanentemente o v√≠nculo. Se a mochila estiver em uso, o uso ser√° automaticamente encerrado.
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ"
}</pre>
        
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "V√≠nculo com a mochila removido com sucesso" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila √© obrigat√≥rio" }</code> ou <code>{ "error": "ID do usu√°rio inv√°lido" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Usu√°rio n√£o possui v√≠nculo com esta mochila" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao desvincular mochila" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="put-editar-nome">
        <h2>‚úèÔ∏è PUT - /usuarios-mochilas/editarNome</h2>
        <p>Altera o nome/apelido que o usu√°rio deu para uma mochila vinculada. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ",
    "NovoNome": "Mochila da Academia"
}</pre>
        
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "Nome da mochila atualizado com sucesso" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila e novo nome s√£o obrigat√≥rios" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Usu√°rio n√£o possui v√≠nculo com esta mochila" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao editar nome da mochila" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="post-assumir-uso">
        <h2>‚ñ∂Ô∏è POST - /usuarios-mochilas/assumir</h2>
        <p>Permite que o usu√°rio logado assuma o uso de uma mochila, alterando seu status para "Usando". Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        
        <div class="note">
            <strong>‚ö†Ô∏è Regras de Uso:</strong>
            <ul>
                <li>Apenas um usu√°rio pode usar uma mochila por vez</li>
                <li>Se o usu√°rio j√° estiver usando outra mochila, ela ser√° automaticamente liberada</li>
                <li>Opera√ß√£o at√¥mica para evitar condi√ß√µes de corrida</li>
            </ul>
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ"
}</pre>
        
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "Mochila assumida com sucesso" }</code> ou <code>{ "ok": true, "message": "Mochila j√° esta assumida pelo usu√°rio" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila √© obrigat√≥rio" }</code> ou <code>{ "error": "ID do usu√°rio inv√°lido" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "V√≠nculo entre usu√°rio e mochila n√£o encontrado" }</code></li>
            <li><span class="status-code">409 Conflict:</span> <code>{ "error": "J√° existe um usu√°rio usando esta mochila" }</code> ou <code>{ "error": "Mochila j√° est√° em uso por outro usu√°rio" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao assumir uso" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="post-encerrar-app">
        <h2>‚èπÔ∏è POST - /usuarios-mochilas/encerrarUsoApp</h2>
        <p>Encerra o uso de uma mochila que est√° em status "Usando" ou "√öltimo a Usar" para o usu√°rio logado. Requer <a href="#autenticacao">autentica√ß√£o</a> de usu√°rio.</p>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ"
}</pre>
        
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "Uso encerrado com sucesso" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila √© obrigat√≥rio" }</code> ou <code>{ "error": "ID do usu√°rio inv√°lido" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Usu√°rio n√£o autenticado" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Token inv√°lido para usu√°rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code> ou <code>{ "error": "Usu√°rio n√£o encontrado" }</code></li>
            <li><span class="status-code">409 Conflict:</span> <code>{ "error": "Nenhum uso ativo encontrado para encerrar" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao encerrar uso" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="post-encerrar-iot">    
        <h2>üîå POST - /usuarios-mochilas/encerrarUsoIOT</h2>
        <p>Encerra o uso de uma mochila por meio do dispositivo IoT, alterando o status para "√öltimo a Usar". Requer autentica√ß√£o espec√≠fica da mochila (IoT).</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Autentica√ß√£o Espec√≠fica:</strong> Esta rota requer token JWT do tipo <code>iot</code>, n√£o de usu√°rio.
        </div>
        
        <h3>Cabe√ßalho da requisi√ß√£o:</h3>
        <pre>Authorization: Bearer &lt;iot_token&gt;</pre>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <p>N√£o h√° corpo de requisi√ß√£o. A mochila √© identificada pelo token JWT.</p>
        
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "Uso encerrado com sucesso" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "ID da mochila inv√°lido" }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "error": "Mochila n√£o autenticada" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Acesso negado. Token inv√°lido para mochila." }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code></li>
            <li><span class="status-code">409 Conflict:</span> <code>{ "error": "Nenhum uso ativo encontrado para encerrar" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao encerrar uso" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>
</body>

</html>