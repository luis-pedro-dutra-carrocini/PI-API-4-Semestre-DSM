<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API - Documenta√ß√£o Mochilas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1,
        h2,
        h3 {
            color: #222;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        pre {
            background: #eee;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }

        a {
            color: #0056b3;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-block;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .status-code {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }

        .note {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .warning {
            background-color: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .auth-info {
            background-color: #e6f7ff;
            border-left: 4px solid #3399ff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>üéí API - Mochilas</h1>
    <p>Esta √© a documenta√ß√£o da API relacionada √†s mochilas. Todos os endpoints exigem autentica√ß√£o de administrador,
        exceto a busca por c√≥digo e o login IoT.</p>

    <div class="section" id="endpoints">
        <h2>üîó Endpoints</h2>
        <ul>
            <li><a href="index.html">Voltar ao Menu</a></li>
        </ul>
        <ul>
            <li><a href="#post">POST - /mochilas/</a> - Criar mochila</li>
            <li><a href="#get-codigo">GET - /mochilas/codigo/:codigo</a> - Buscar mochila por c√≥digo</li>
            <li><a href="#put">PUT - /mochilas/</a> - Atualizar mochila</li>
            <li><a href="#delete">DELETE - /mochilas/</a> - Excluir mochila (desativar)</li>
            <li><a href="#login">POST - /loginMochila/</a> - Login da mochila (IoT)</li>
            <li><a href="#put-status">PUT - /mochilas/status/s</a> - Alterar status da mochila</li>
        </ul>
    </div>

    <div class="section" id="autenticacao">
        <h2>üîí Autentica√ß√£o</h2>
        <p>A maioria dos endpoints desta API requer autentica√ß√£o de administrador via <strong>credenciais espec√≠ficas</strong> no corpo da requisi√ß√£o.</p>
        
        <div class="auth-info">
            <h4>‚ö†Ô∏è Nota Importante:</h4>
            <p>As rotas de gerenciamento (POST, PUT, DELETE) n√£o usam JWT, mas sim valida√ß√£o direta de senhas espec√≠ficas no corpo da requisi√ß√£o:</p>
            <ul>
                <li><code>password</code>: Senha espec√≠fica para a opera√ß√£o (cria√ß√£o, atualiza√ß√£o, exclus√£o)</li>
                <li><code>passwordAdmin</code>: Senha do administrador</li>
                <li><code>AdminEmail</code>: Email do administrador</li>
            </ul>
        </div>
        
        <div class="note">
            <strong>Exce√ß√µes:</strong> A rota <strong>GET /mochilas/codigo/:codigo</strong> e <strong>POST /loginMochila/</strong> n√£o requerem autentica√ß√£o de administrador.
        </div>
    </div>

    <div class="section" id="post">
        <h2>üì§ POST /mochilas</h2>
        <p>Cria uma nova mochila no sistema. Requer autentica√ß√£o de administrador e a senha de cria√ß√£o. A mochila √© criada com status "Produ√ß√£o".</p>
        
        <div class="note">
            <strong>‚ö†Ô∏è Status Inicial:</strong> Todas as mochilas s√£o criadas com status "Produ√ß√£o". Use a rota de altera√ß√£o de status para mudar para "Ativo".
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaPesoMax": 10.5,
    "MochilaDescricao": "Mochila de teste para uso em campo",
    "AdminEmail": "admin@email.com",
    "passwordAdmin": "SenhaDoAdmin",
    "password": "SenhaDeCriacao"
}</pre>
        <h3>Resposta de Sucesso (201 Created):</h3>
        <pre>{
    "mochilaCadastrada": {
        "MochilaCodigo": "ABC123XYZ789",
        "MochilaPesoMax": 10.5,
        "MochilaDtCadastro": "2025-09-15T10:30:00.000Z",
        "MochilaDtAlteracao": "2025-09-15T10:30:00.000Z",
        "MochilaStatus": "Produ√ß√£o",
        "AdminId": 1,
        "MochilaDescricao": "Mochila de teste para uso em campo",
        "MochilaSenha": "SenhaGeradaAutomaticamente"
    },
    "ok": true,
    "message": "Mochila cadastrada com sucesso"
}</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">201 Created:</span> Mochila criada com sucesso</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "Peso m√°ximo da mochila √© obrigat√≥rio e deve ser de 0,1 √† 50 kg" }</code> ou <code>{ "error": "Descri√ß√£o da mochila √© obrigat√≥ria" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Senha incorreta" }</code> ou <code>{ "error": "Senhas e e-mail obrigat√≥rios para cria√ß√£o" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Administrador n√£o encontrado" }</code></li>
            <li><span class="status-code">409 Conflict:</span> <code>{ "error": "Mochila j√° cadastrada, c√≥digo j√° usado, tente novamente" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao criar mochila" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="get-codigo">
        <h2>üì• GET /mochilas/codigo/:codigo</h2>
        <p>Busca uma mochila espec√≠fica pelo c√≥digo. N√£o requer autentica√ß√£o. Apenas retorna mochilas com status "Ativo".</p>
        <h3>Par√¢metros da URL:</h3>
        <pre>/mochilas/codigo/ABC123XYZ789</pre>
        <h3>Resposta de Sucesso (200 OK):</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ789",
    "MochilaPesoMax": 10.5,
    "MochilaDtCadastro": "2025-09-15T10:30:00.000Z",
    "MochilaStatus": "Ativo",
    "MochilaDescricao": "Mochila de teste para uso em campo"
}</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Retorna os dados da mochila (exceto a senha)</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "Codigo da mochila √© obrigat√≥rio" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Mochila n√£o encontrada" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao obter mochilas" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="put">
        <h2>‚úèÔ∏è PUT /mochilas/</h2>
        <p>Atualiza os dados de uma mochila. Requer autentica√ß√£o de administrador e a senha de altera√ß√£o. Apenas mochilas com status "Produ√ß√£o" podem ser alteradas.</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Restri√ß√£o:</strong> Apenas mochilas com status "Produ√ß√£o" podem ser alteradas. Mochilas "Ativo" ou "Inativo" n√£o podem ser modificadas.
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ789",
    "MochilaPesoMax": 12.0,
    "MochilaDescricao": "Mochila de teste - atualizada",
    "AdminEmail": "admin@email.com",
    "passwordAdmin": "SenhaDoAdmin",
    "password": "SenhaDeAlteracao",
    "AlterarSenha": "N√£o" // "Sim" ou "Somente"
}</pre>
        <div class="note">
            <strong>Op√ß√µes de AlterarSenha:</strong>
            <ul>
                <li><code>"N√£o"</code>: Apenas atualiza dados (padr√£o)</li>
                <li><code>"Sim"</code>: Atualiza dados e gera nova senha</li>
                <li><code>"Somente"</code>: Apenas gera nova senha (sem alterar outros dados)</li>
            </ul>
        </div>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "Mochila alterada com sucesso", "mochilaAlterada": { ... } }</code> ou <code>{ "ok": true, "message": "Senha da mochila alterada com sucesso", "MochilaSenha": "nova_senha_gerada" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila √© inv√°lido" }</code>, <code>{ "error": "Peso m√°ximo da mochila √© obrigat√≥rio e deve ser de 0,1 √† 50 kg" }</code> ou <code>{ "error": "Descri√ß√£o √© obrigatoria" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Senha incorreta" }</code> ou <code>{ "error": "Senhas e e-mail obrigat√≥rios para altera√ß√£o" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Administrador n√£o encontrado" }</code> ou <code>{ "error": "Mochila n√£o encontrada ou j√° exclu√≠da ou n√£o poss√≠vel edita-la" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao alterar mochila" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="delete">
        <h2>üóë DELETE /mochilas/</h2>
        <p>Exclui uma mochila, alterando seu status para "Inativo". Requer autentica√ß√£o de administrador e a senha de exclus√£o. Apenas mochilas com status "Ativo" podem ser exclu√≠das.</p>
        
        <div class="note">
            <strong>‚ö†Ô∏è Exclus√£o L√≥gica:</strong> A mochila n√£o √© removida do banco, apenas tem seu status alterado para "Inativo".
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ789",
    "AdminEmail": "admin@email.com",
    "passwordAdmin": "SenhaDoAdmin",
    "password": "SenhaDeExclusao"
}</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "Mochila exclu√≠da com sucesso" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila √© inv√°lido" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Senha incorreta" }</code> ou <code>{ "error": "Senhas e e-mail obrigat√≥rios para exclus√£o" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Administrador n√£o encontrado" }</code> ou <code>{ "error": "Mochila n√£o encontrada ou j√° exclu√≠da" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao excluir mochila" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="login">
        <h2>üîë POST /loginMochila/</h2>
        <p>Autentica uma mochila (dispositivo IoT) usando uma assinatura digital para emitir um token de acesso e um de atualiza√ß√£o. Apenas mochilas com status "Ativo" podem fazer login.</p>
        
        <div class="note">
            <strong>‚ö†Ô∏è Status Requerido:</strong> Apenas mochilas com status "Ativo" podem se autenticar.
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ789",
    "assinatura": "assinatura_digital_da_mochila",
    "timestamp": "2025-09-15T10:30:00.000Z"
}</pre>
        <h3>Resposta de Sucesso (200 OK):</h3>
        <pre>{
    "ok": true,
    "message": "Autentica√ß√£o da mochila realizada com sucesso.",
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> Autentica√ß√£o realizada com sucesso</li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila, assinatura e timestamp s√£o obrigat√≥rios." }</code></li>
            <li><span class="status-code">401 Unauthorized:</span> <code>{ "ok": false, "message": "Mochila n√£o encontrada ou inativa." }</code> ou <code>{ "ok": false, "message": "Assinatura inv√°lida. Autentica√ß√£o falhou." }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro interno do servidor." }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>

    <div class="section" id="put-status">
        <h2>üîÑ PUT - /mochilas/status/s</h2>
        <p>Altera o status de uma mochila para 'Ativo' ou 'Produ√ß√£o'. Requer autentica√ß√£o de administrador e senhas espec√≠ficas para confirma√ß√£o.</p>
        
        <div class="note">
            <strong>Status Permitidos:</strong> "Ativo" ou "Produ√ß√£o". N√£o √© poss√≠vel alterar para "Inativo" por esta rota (use DELETE).
        </div>
        
        <h3>Corpo da requisi√ß√£o:</h3>
        <pre>{
    "MochilaCodigo": "ABC123XYZ789",
    "MochilaStatus": "Ativo",
    "AdminEmail": "admin@email.com",
    "passwordAdmin": "SenhaDoAdmin",
    "password": "SenhaParaAlterarStatus"
}</pre>
        <h3>Respostas:</h3>
        <ul>
            <li><span class="status-code">200 OK:</span> <code>{ "ok": true, "message": "Status da mochila alterado com sucesso" }</code></li>
            <li><span class="status-code">400 Bad Request:</span> <code>{ "error": "C√≥digo da mochila √© inv√°lido" }</code> ou <code>{ "error": "Status da mochila inv√°lido. Status permitidos ['Ativo', 'Produ√ß√£o']" }</code></li>
            <li><span class="status-code">403 Forbidden:</span> <code>{ "error": "Senhas e e-mail obrigat√≥rios para a altera√ß√£o de status" }</code> ou <code>{ "error": "Senha incorreta" }</code></li>
            <li><span class="status-code">404 Not Found:</span> <code>{ "error": "Administrador n√£o encontrado" }</code> ou <code>{ "error": "Mochila n√£o encontrada ou j√° exclu√≠da" }</code></li>
            <li><span class="status-code">500 Internal Server Error:</span> <code>{ "error": "Erro ao alterar status da mochila" }</code></li>
        </ul>
        <a href="#endpoints" class="back-link">‚¨Ö Voltar para Endpoints</a>
    </div>
</body>

</html>